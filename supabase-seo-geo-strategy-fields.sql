-- Add SEO/GEO Strategy fields to submissions table
ALTER TABLE submissions 
ADD COLUMN IF NOT EXISTS seo_geo_strategy JSONB,
ADD COLUMN IF NOT EXISTS seo_geo_strategy_generated_at TIMESTAMP WITH TIME ZONE;

-- SEO/GEO Strategy JSON Structure
-- {
--   "page1": {
--     "strategic_objectives": {
--       "seo_goals": ["goal1", "goal2", "goal3", "goal4"],
--       "geo_goals": ["goal1", "goal2", "goal3", "goal4"]
--     },
--     "market_context": {
--       "monthly_search_volume": 50000,
--       "voice_search_growth": "65%",
--       "ai_assisted_searches": "42%",
--       "competitive_positioning": "text..."
--     },
--     "success_metrics": {
--       "serp_ranking_target": "Top 3",
--       "ai_citation_rate": "80%",
--       "backlink_targets": "500+",
--       "avg_engagement_time": "45 sec"
--     }
--   },
--   "page2": {
--     "keyword_strategy": {
--       "tier1_primary": [
--         {"keyword": "keyword1", "volume": 5000},
--         {"keyword": "keyword2", "volume": 3000}
--       ],
--       "tier2_longtail": [
--         {"keyword": "long tail 1", "volume": 500},
--         {"keyword": "long tail 2", "volume": 300}
--       ],
--       "tier3_voice_ai": [
--         "What is product name?",
--         "How does product work?"
--       ]
--     },
--     "content_architecture": {
--       "h1_tag": "Primary H1 Tag",
--       "h1_conversational": "Conversational H1 Alternative",
--       "h2_tags": ["H2 tag 1", "H2 tag 2", "H2 tag 3", "H2 tag 4"]
--     },
--     "distribution_channels": {
--       "traditional": ["channel1", "channel2", "channel3", "channel4"],
--       "ai_optimized": ["channel1", "channel2", "channel3", "channel4"]
--     }
--   },
--   "page3": {
--     "geo_tactics": {
--       "authoritative_sources": ["FDA docs", "Clinical trials", "Medical journals", "Guidelines"],
--       "statistics_data": ["Efficacy: 85%", "Response rate: 70%", "Safety: 92%", "Adherence: 88%"],
--       "technical_terms": ["mechanism of action", "pharmacokinetics", "bioavailability", "receptor binding"],
--       "direct_questions": ["What is X?", "How does X work?", "Who can take X?", "Side effects of X?"]
--     },
--     "schema_markup": {
--       "@context": "https://schema.org",
--       "@type": "Drug",
--       "name": "product name",
--       ...
--     },
--     "platform_optimization": {
--       "chatgpt": ["tactic1", "tactic2", "tactic3"],
--       "perplexity": ["tactic1", "tactic2", "tactic3"],
--       "claude": ["tactic1", "tactic2", "tactic3"],
--       "google_sge": ["tactic1", "tactic2", "tactic3"]
--     }
--   },
--   "page4": {
--     "kpis": [
--       {"metric": "SERP Position", "target": "Top 3", "current": null},
--       {"metric": "AI Citation Rate", "target": "85%", "current": null},
--       {"metric": "Voice Search Ready", "target": "92%", "current": null},
--       {"metric": "Content Quality", "target": "4.5/5", "current": null}
--     ],
--     "monitoring_protocol": {
--       "seo_monitoring": [
--         {"task": "Rank tracking", "frequency": "Daily"},
--         {"task": "Traffic analysis", "frequency": "Weekly"},
--         {"task": "Backlink review", "frequency": "Monthly"},
--         {"task": "Content audit", "frequency": "Quarterly"}
--       ],
--       "ai_monitoring": [
--         {"task": "AI query testing", "frequency": "Weekly"},
--         {"task": "Brand mentions", "frequency": "Weekly"},
--         {"task": "Citation analysis", "frequency": "Monthly"},
--         {"task": "Voice search test", "frequency": "Monthly"}
--       ]
--     },
--     "optimization_roadmap": {
--       "q1": "Foundation & Launch: Implement core SEO/GEO strategy",
--       "q2": "Expansion & Testing: A/B test variations",
--       "q3": "Optimization & Scale: Refine based on data",
--       "q4": "Authority Building: Maximize AI citations"
--     },
--     "compliance_notes": "All content requires MLR review. No competitive comparisons."
--   }
-- }

-- Create index for faster queries
CREATE INDEX IF NOT EXISTS idx_submissions_seo_geo_strategy ON submissions USING GIN (seo_geo_strategy);

-- Add comment
COMMENT ON COLUMN submissions.seo_geo_strategy IS 'Comprehensive 4-page SEO/GEO strategy document generated by Perplexity AI';
COMMENT ON COLUMN submissions.seo_geo_strategy_generated_at IS 'Timestamp when the SEO/GEO strategy was generated';